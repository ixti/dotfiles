# vim: ft=zsh

local attr="github"
local name="token"

case "${1:-}" in
  update)
    print "Visit <https://github.com/settings/tokens> and create/update token"

    "${BROWSER}" "https://github.com/settings/tokens"

    print "Please create new token and paste it here..."

    secret-tool store --label="Github Private Registries Access Token" "${attr}" "${name}"

    gh-access-token setup

    return
    ;;

  setup)
    typeset token="$(gh-access-token)"
    typeset -gx BUNDLE_RUBYGEMS__PKG__GITHUB__COM="x-api-token:${token}"

    return
    ;;

  *)
    secret-tool lookup "${attr}" "${name}"

    return
    ;;
esac
